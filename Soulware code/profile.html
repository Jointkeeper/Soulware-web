<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Личный кабинет — Soulware</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="js/lang.js"></script>
  <script defer src="js/auth.js"></script>
</head>
<body class="bg-gray-900 text-white font-sans">

  <!-- Навигационная панель (такая же как на главной) -->
  <header class="bg-gray-800 border-b border-gray-700 sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
      <a href="index.html" class="text-xl font-bold text-purple-400">Soulware</a>
      <nav class="hidden md:flex space-x-6 text-sm">
        <a href="catalog.html" class="hover:text-purple-400 transition-colors">Тесты</a>
        <a href="daily.html" class="hover:text-purple-400 transition-colors">Тест дня</a>
        <a href="recommendations.html" class="hover:text-purple-400 transition-colors">Рекомендации</a>
        <a href="profile.html" class="hover:text-purple-400 transition-colors">Личный кабинет</a>
        <a href="subscribe.html" class="hover:text-purple-400 transition-colors">Поддержка</a>
        <button id="auth-button" class="bg-purple-600 hover:bg-purple-700 px-4 py-1 rounded transition-colors">
          Войти
        </button>
      </nav>
      <button class="md:hidden text-gray-400 hover:text-white" id="mobile-menu-button">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
      </button>
    </div>
    <!-- Мобильное меню -->
    <div class="md:hidden hidden" id="mobile-menu">
      <div class="px-2 pt-2 pb-3 space-y-1">
        <a href="catalog.html" class="block px-3 py-2 hover:bg-gray-700 rounded">Тесты</a>
        <a href="daily.html" class="block px-3 py-2 hover:bg-gray-700 rounded">Тест дня</a>
        <a href="recommendations.html" class="block px-3 py-2 hover:bg-gray-700 rounded">Рекомендации</a>
        <a href="profile.html" class="block px-3 py-2 hover:bg-gray-700 rounded">Личный кабинет</a>
        <a href="subscribe.html" class="block px-3 py-2 hover:bg-gray-700 rounded">Поддержка</a>
      </div>
    </div>
  </header>

  <main class="p-6 max-w-4xl mx-auto" id="profile-container">
    <!-- Базовый профиль -->
    <div class="text-center mb-12">
      <div class="relative inline-block">
        <img id="profile-avatar" src="https://placekitten.com/150/150" alt="AI Avatar" 
             class="w-32 h-32 rounded-full border-4 border-purple-500 mb-4">
        <button id="regenerate-avatar" class="absolute bottom-4 right-0 bg-purple-600 p-2 rounded-full hover:bg-purple-700 transition-colors">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
          </svg>
        </button>
      </div>
      <h1 id="profile-name" class="text-2xl font-bold text-purple-300 mb-2">Загрузка...</h1>
      <p id="profile-status" class="text-gray-400">Статус подписки: <span class="text-purple-400">Базовый</span></p>
    </div>

    <!-- Вкладки -->
    <div class="mb-8">
      <div class="border-b border-gray-700">
        <nav class="-mb-px flex space-x-8" aria-label="Tabs">
          <button class="border-purple-500 text-purple-400 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" id="tab-summary">
            Сводка
          </button>
          <button class="border-transparent text-gray-400 hover:text-gray-300 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" id="tab-history">
            История тестов
          </button>
          <button class="border-transparent text-gray-400 hover:text-gray-300 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm" id="tab-settings">
            Настройки
          </button>
        </nav>
      </div>
    </div>

    <!-- Контент вкладок -->
    <div id="tab-content">
      <!-- Сводка -->
      <div id="content-summary" class="space-y-6">
        <div class="bg-gray-800 rounded-lg p-6">
          <h2 class="text-xl font-semibold mb-4">Ваш архетипический профиль</h2>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="archetype-grid">
            <!-- Архетипы будут загружены динамически -->
            <div class="animate-pulse">
              <div class="h-24 bg-gray-700 rounded mb-2"></div>
              <div class="h-4 bg-gray-700 rounded w-3/4"></div>
            </div>
          </div>
        </div>

        <div class="bg-gray-800 rounded-lg p-6">
          <h2 class="text-xl font-semibold mb-4">Прогресс</h2>
          <div class="space-y-4">
            <div class="flex items-center">
              <span class="text-sm text-gray-400 w-32">Пройдено тестов:</span>
              <div class="flex-1 bg-gray-700 rounded-full h-2">
                <div class="bg-purple-500 rounded-full h-2" style="width: 45%"></div>
              </div>
              <span class="text-sm text-gray-400 ml-4">45/100</span>
            </div>
            <div class="flex items-center">
              <span class="text-sm text-gray-400 w-32">Уровень:</span>
              <div class="flex-1 bg-gray-700 rounded-full h-2">
                <div class="bg-purple-500 rounded-full h-2" style="width: 60%"></div>
              </div>
              <span class="text-sm text-gray-400 ml-4">3</span>
            </div>
          </div>
        </div>

        <div class="bg-gray-800 rounded-lg p-6">
          <h2 class="text-xl font-semibold mb-4">Последние достижения</h2>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="achievements-grid">
            <!-- Достижения будут загружены динамически -->
            <div class="animate-pulse">
              <div class="h-24 bg-gray-700 rounded mb-2"></div>
              <div class="h-4 bg-gray-700 rounded w-3/4"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- История -->
      <div id="content-history" class="hidden space-y-6">
        <div class="bg-gray-800 rounded-lg p-6">
          <h2 class="text-xl font-semibold mb-4">История тестов</h2>
          <div class="space-y-4" id="test-history">
            <!-- История будет загружена динамически -->
            <div class="animate-pulse">
              <div class="h-16 bg-gray-700 rounded mb-4"></div>
              <div class="h-16 bg-gray-700 rounded"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Настройки -->
      <div id="content-settings" class="hidden space-y-6">
        <div class="bg-gray-800 rounded-lg p-6">
          <h2 class="text-xl font-semibold mb-6">Настройки профиля</h2>
          <form id="settings-form" class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-400 mb-2">Имя</label>
              <input type="text" id="settings-name" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:border-purple-500">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-400 mb-2">Email</label>
              <input type="email" id="settings-email" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:border-purple-500">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-400 mb-2">Язык</label>
              <select id="settings-language" class="w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:border-purple-500">
                <option value="ru">Русский</option>
                <option value="en">English</option>
              </select>
            </div>
            <div class="pt-4">
              <button type="submit" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-medium py-2 px-4 rounded transition-colors">
                Сохранить изменения
              </button>
            </div>
          </form>
        </div>

        <div class="bg-gray-800 rounded-lg p-6">
          <h2 class="text-xl font-semibold mb-6">Уведомления</h2>
          <div class="space-y-4">
            <label class="flex items-center">
              <input type="checkbox" class="form-checkbox h-4 w-4 text-purple-600 rounded border-gray-600 bg-gray-700">
              <span class="ml-2 text-gray-400">Ежедневные напоминания о тесте дня</span>
            </label>
            <label class="flex items-center">
              <input type="checkbox" class="form-checkbox h-4 w-4 text-purple-600 rounded border-gray-600 bg-gray-700">
              <span class="ml-2 text-gray-400">Новые рекомендации</span>
            </label>
            <label class="flex items-center">
              <input type="checkbox" class="form-checkbox h-4 w-4 text-purple-600 rounded border-gray-600 bg-gray-700">
              <span class="ml-2 text-gray-400">Обновления профиля</span>
            </label>
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer class="text-center text-gray-500 text-sm p-4 border-t border-gray-700 mt-12">
    <p data-i18n="footer_text">© 2025 Soulware. Все права защищены.</p>
  </footer>

  <script>
    // Мобильное меню
    document.getElementById('mobile-menu-button').addEventListener('click', () => {
      document.getElementById('mobile-menu').classList.toggle('hidden');
    });

    // Проверка авторизации
    document.addEventListener('DOMContentLoaded', () => {
      if (!window.auth.isAuthenticated) {
        window.location.href = '/login.html?redirect=profile.html';
        return;
      }

      // Загрузка данных профиля
      loadProfileData();

      // Обработчики вкладок
      setupTabs();
    });

    function loadProfileData() {
      // TODO: Загрузка данных с бэкенда
      // Временные данные для демонстрации
      const mockData = {
        name: 'Александр',
        avatar: 'https://placekitten.com/150/150',
        subscription: 'Базовый',
        archetypes: [
          { name: 'Творец', level: 75 },
          { name: 'Мудрец', level: 60 },
          { name: 'Искатель', level: 45 },
          { name: 'Герой', level: 30 }
        ],
        achievements: [
          { name: 'Первый шаг', description: 'Пройден первый тест' },
          { name: 'Исследователь', description: 'Пройдено 10 тестов' }
        ]
      };

      updateProfileUI(mockData);
    }

    function updateProfileUI(data) {
      document.getElementById('profile-name').textContent = data.name;
      document.getElementById('profile-avatar').src = data.avatar;
      document.getElementById('profile-status').innerHTML = 
        `Статус подписки: <span class="text-purple-400">${data.subscription}</span>`;

      // TODO: Обновление остальных элементов UI
    }

    function setupTabs() {
      const tabs = ['summary', 'history', 'settings'];
      tabs.forEach(tab => {
        document.getElementById(`tab-${tab}`).addEventListener('click', () => {
          // Скрываем все контенты
          tabs.forEach(t => {
            document.getElementById(`content-${t}`).classList.add('hidden');
            document.getElementById(`tab-${t}`).classList.remove('border-purple-500', 'text-purple-400');
            document.getElementById(`tab-${t}`).classList.add('border-transparent', 'text-gray-400');
          });
          
          // Показываем выбранный контент
          document.getElementById(`content-${tab}`).classList.remove('hidden');
          document.getElementById(`tab-${tab}`).classList.add('border-purple-500', 'text-purple-400');
          document.getElementById(`tab-${tab}`).classList.remove('border-transparent', 'text-gray-400');
        });
      });
    }

    // Обработчик регенерации аватара
    document.getElementById('regenerate-avatar').addEventListener('click', () => {
      // TODO: Интеграция с AI-сервисом для генерации аватара
      console.log('Регенерация аватара...');
    });

    // Обработчик формы настроек
    document.getElementById('settings-form').addEventListener('submit', (e) => {
      e.preventDefault();
      // TODO: Сохранение настроек на бэкенде
      console.log('Сохранение настроек...');
    });
  </script>
</body>
</html>
